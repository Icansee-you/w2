{% extends 'base.html' %}
{% load news_filters %}

{% block title %}Mijn Nieuws - NOS Nieuws Aggregator{% endblock %}

{% block extra_css %}
<style>
    .articles-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .article-card {
        background-color: white;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        transition: transform 0.2s, box-shadow 0.2s;
        height: 100%;
    }
    
    .article-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .article-card h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
        line-height: 1.3;
    }
    
    .article-card h3 a {
        color: #333;
        text-decoration: none;
    }
    
    .article-card h3 a:hover {
        color: #d32f2f;
    }
    
    .article-meta {
        color: #666;
        font-size: 0.75rem;
        margin-bottom: 0.5rem;
    }
    
    .article-category {
        display: inline-block;
        background-color: #e0e0e0;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        font-size: 0.7rem;
        margin-left: 0.5rem;
    }
    
    .article-summary {
        font-size: 0.85rem;
        color: #555;
        line-height: 1.4;
        flex-grow: 1;
        margin-bottom: 0.5rem;
    }
    
    .article-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 4px;
        margin-top: 0.5rem;
    }
    
    @media (max-width: 1200px) {
        .articles-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .articles-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 480px) {
        .articles-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h1>Mijn Nieuws</h1>
    
    {% if user_categories.count == 0 %}
        <p>Je hebt nog geen categorieën geselecteerd. Ga naar <a href="{% url 'accounts:preferences' %}">Voorkeuren</a> om categorieën te kiezen.</p>
    {% else %}
        <!-- Search Box -->
        <div class="search-box">
            <form method="get" action="{% url 'news:my_news' %}">
                <input type="text" name="q" value="{{ search_query }}" placeholder="Zoeken in nieuws..." />
                {% if category_filter %}
                    <input type="hidden" name="category" value="{{ category_filter }}" />
                {% endif %}
            </form>
        </div>
        
        <!-- Category Filters -->
        <div class="category-pills">
            <a href="{% url 'news:my_news' %}{% if search_query %}?q={{ search_query }}{% endif %}" 
               class="category-pill {% if not category_filter %}active{% endif %}">
                Alle
            </a>
            {% for category in categories %}
                {% if category in user_categories %}
                    <a href="{% url 'news:my_news' %}?category={{ category.key }}{% if search_query %}&q={{ search_query }}{% endif %}" 
                       class="category-pill {% if category_filter == category.key %}active{% endif %}">
                        {{ category.name }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>
        
        <!-- Articles Grid -->
        {% if articles %}
            <div class="articles-grid">
                {% for article in articles %}
                    <div class="article-card">
                        <h3><a href="{% url 'news:article_detail' article.id %}">{{ article.title }}</a></h3>
                        <div class="article-meta">
                            {{ article.published_at|date:"d-m-Y H:i" }}
                            {% if article.category %}
                                <span class="article-category">{{ article.category.name }}</span>
                            {% endif %}
                        </div>
                        {% if article.image_url %}
                            <img src="{{ article.image_url }}" alt="{{ article.title }}" class="article-image" />
                        {% endif %}
                        <div class="article-summary">
                            {% if article.summary %}
                                {{ article.summary|strip_html|truncatewords:30 }}
                            {% elif article.content %}
                                {{ article.content|strip_html|truncatewords:30 }}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if articles.has_other_pages %}
                <div class="pagination">
                    {% if articles.has_previous %}
                        <a href="?page={{ articles.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">Vorige</a>
                    {% endif %}
                    
                    <span class="current">
                        Pagina {{ articles.number }} van {{ articles.paginator.num_pages }}
                    </span>
                    
                    {% if articles.has_next %}
                        <a href="?page={{ articles.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">Volgende</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <p>Geen artikelen gevonden voor je huidige filters.</p>
        {% endif %}
    {% endif %}
</div>
{% endblock %}

